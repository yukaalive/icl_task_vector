[nltk_data] Downloading package wordnet to /root/nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package omw-1.4 to /root/nltk_data...
[nltk_data]   Package omw-1.4 is already up-to-date!
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:01<00:01,  1.98s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.26s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.36s/it]
Evaluating model: meta-llama Llama-2-7b-hf
Loading model and tokenizer...
Loaded model and tokenizer.
WARNING: mapping singular_plural has only 31 examples after filtering (173 before)
WARNING: mapping plural_singular has only 44 examples after filtering (172 before)
=== Baseline Prompt Example (task: translation_fr_en) ===
<s> example: pouvoir->

=== ICL Prompt Example ===
<s> example: chiffre-> figure
example: étudier-> study
example: futur-> future
example: au-> on
example: possible-> possible
example: ici->

================================================================================

=== Baseline Prompt Example (task: linguistic_present_simple_gerund) ===
<s> example: run->

=== ICL Prompt Example ===
<s> example: burn-> burning
example: happen-> happening
example: ask-> asking
example: declare-> declaring
example: lead-> leading
example: write->

================================================================================

=== Baseline Prompt Example (task: knowledge_country_capital) ===
<s> example:Grand Duchy of Finland->

=== ICL Prompt Example ===
<s> example:Rif Dimashq Governorate->Damascus
example:Belgium->Brussels
example:Flanders->Brussels
example:Kingdom of Libya->Tripoli
example:Portugal->Lisbon
example:Uusimaa->

================================================================================

=== Baseline Prompt Example (task: algorithmic_next_letter) ===
<s> example:c->

=== ICL Prompt Example ===
<s> example:r->s
example:b->c
example:m->n
example:g->h
example:w->x
example:i->

================================================================================

=== Baseline Prompt Example (task: translation_es_en) ===
<s> example: piso->

=== ICL Prompt Example ===
<s> example: cuatro-> four
example: aviso-> notice
example: esposo-> husband
example: caer-> fall
example: otro-> another
example: global->

================================================================================

=== Baseline Prompt Example (task: translation_en_fr) ===
<s> example: argument->

=== ICL Prompt Example ===
<s> example: woman-> femme
example: how-> comment
example: into-> dans
example: who-> qui
example: view-> voir
example: staff->

================================================================================

=== Baseline Prompt Example (task: translation_en_es) ===
<s> example: director->

=== ICL Prompt Example ===
<s> example: ok-> ok
example: say-> decir
example: father-> padre
example: list-> lista
example: date-> fecha
example: club->

================================================================================

=== Baseline Prompt Example (task: linguistic_present_simple_past_simple) ===
<s> example: operate->

=== ICL Prompt Example ===
<s> example: allow-> allowed
example: bear-> bore
example: act-> acted
example: collect-> collected
example: mean-> meant
example: earn->

================================================================================

WARNING: mapping plural_singular has only 44 examples after filtering (172 before)
=== Baseline Prompt Example (task: linguistic_plural_singular) ===
<s> example: these->

=== ICL Prompt Example ===
<s> example: bases-> basis
example: embargoes-> embargo
example: mice-> mouse
example: matrices-> matrix
example: women-> woman
example: cod->

================================================================================

=== Baseline Prompt Example (task: linguistic_antonyms) ===
<s> example: positive->

=== ICL Prompt Example ===
<s> example: soft-> hard
example: arrive-> depart
example: top-> bottom
example: long-> short
example: east-> west
example: heavy->

================================================================================

=== Baseline Prompt Example (task: knowledge_person_language) ===
<s> example:Jeanne Moreau->

=== ICL Prompt Example ===
<s> example:Rajit Kapur->Hindi
example:Thomas Piketty->French
example:Yizhar Harari->Hebrew
example:Natalia Lafourcade->Spanish
example:Lau Kar-leung->Chinese
example:Arnold Chikobava->

================================================================================

=== Baseline Prompt Example (task: knowledge_location_continent) ===
<s> example:Cannonball Cliffs->

=== ICL Prompt Example ===
<s> example:Jones Bluffs->Antarctica
example:Kotis Point->Antarctica
example:Coppermine Peninsula->Antarctica
example:Reeves Glacier->Antarctica
example:Cosgrove Ice Shelf->Antarctica
example:Siple Dome->

================================================================================

=== Baseline Prompt Example (task: knowledge_location_religion) ===
<s> example:Muhammad Shah->

=== ICL Prompt Example ===
<s> example:Charles V of France->Christian
example:Heidi Baker->Christian
example:Zheng He->Muslim
example:Jewish Theological Seminary of America->Jewish
example:Hosni Mubarak->Muslim
example:Sheikh Abubakr Ahmad->

================================================================================

=== Baseline Prompt Example (task: algorithmic_prev_letter) ===
<s> example:z->

=== ICL Prompt Example ===
<s> example:y->x
example:s->r
example:f->e
example:v->u
example:p->o
example:u->

================================================================================

=== Baseline Prompt Example (task: algorithmic_list_first) ===
<s> example:z,e->

=== ICL Prompt Example ===
<s> example:x,q,t,s->x
example:r,h,l->r
example:d,o,o->d
example:p,t,p->p
example:o,q,p,v->o
example:i,g,t->

================================================================================

=== Baseline Prompt Example (task: algorithmic_list_last) ===
<s> example:m,u,s,u->

=== ICL Prompt Example ===
<s> example:k,o,n,n->n
example:z,z->z
example:h,z,g,m->m
example:h,t,y,b->b
example:a,j,y,k->k
example:e,t,b->

================================================================================

=== Baseline Prompt Example (task: algorithmic_to_upper) ===
<s> example:c->

=== ICL Prompt Example ===
<s> example:m->M
example:r->R
example:y->Y
example:p->P
example:o->O
example:t->

================================================================================

=== Baseline Prompt Example (task: algorithmic_to_lower) ===
<s> example:Z->

=== ICL Prompt Example ===
<s> example:Q->q
example:Z->z
example:L->l
example:O->o
example:U->u
example:E->

================================================================================


==================================================
Running task 1/27: translation_fr_en
Evaluating baseline for task: translation_fr_en
Baseline accuracy: 0.1500
Evaluating ICL and Task Vector for task: translation_fr_en
ICL accuracy: 0.8000
Debug: モデルは合計32層あります
Debug: テスト対象の層は合計32層です
Debug: タスクhiddensを取得中...
Debug: 単一コンテキストからタスクhiddensを取得中...
Debug: データセット 1/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 2/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 3/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 4/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 5/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 6/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 7/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 8/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 9/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 10/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 11/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 12/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 13/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 14/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 15/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 16/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 17/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 18/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 19/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 20/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 21/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 22/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 23/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 24/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: データセット 25/25 処理中
Debug: トレース出力はタプル型です (長さ: 2)
Debug: hidden_states属性を持つオブジェクトを出力タプルの第1要素として検出しました
Debug: hidden_statesはタプル型です (長さ: 33)
Debug: 単一コンテキストhiddens取得完了: shape=torch.Size([25, 1, 46, 4096])
Debug: タスクhiddens取得完了: shape=torch.Size([25, 1, 46, 4096])
Debug: 実験進行状況: [                    ] 0.0% (層 1/32, 現在: 0)
Debug: 層0のテスト中...
Debug: modulated_generate開始 (層=0)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.5391 -> 76.5000 (注入: 76.5000)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 1.8467 -> 122.9375 (注入: 122.9375)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 1.9502 -> 131.3750 (注入: 131.3750)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.5391 -> 82.5625 (注入: 82.5625)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.3301 -> 78.0000 (注入: 78.0000)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.5391 -> 132.0000 (注入: 132.0000)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.5391 -> 79.2500 (注入: 79.2500)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.2344 -> 76.8125 (注入: 76.8125)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.1113 -> 70.7500 (注入: 70.7500)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.2695 -> 131.7500 (注入: 131.7500)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.1328 -> 77.5625 (注入: 77.5625)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.0469 -> 71.6250 (注入: 71.6250)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.2246 -> 116.6250 (注入: 116.6250)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.5391 -> 78.4375 (注入: 78.4375)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.3613 -> 122.9375 (注入: 122.9375)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.0039 -> 79.6875 (注入: 79.6875)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.1367 -> 77.0000 (注入: 77.0000)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.2383 -> 71.5625 (注入: 71.5625)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 1.9463 -> 126.5000 (注入: 126.5000)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.5391 -> 72.0625 (注入: 72.0625)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.3203 -> 122.9375 (注入: 122.9375)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 1.9570 -> 79.8750 (注入: 79.8750)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.5391 -> 74.2500 (注入: 74.2500)
層0の隠れ状態変化: MSE=0.000000
成功: 層0の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.0352 -> 78.9375 (注入: 78.9375)
層0の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([0]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層0の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.2422 -> 70.5625 (注入: 70.5625)
層0の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層0の精度: 0.0000
Debug: 実験進行状況: [                    ] 3.1% (層 2/32, 現在: 1)
Debug: 層1のテスト中...
Debug: modulated_generate開始 (層=1)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.6094 -> 76.5000 (注入: 76.5000)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.7188 -> 122.9375 (注入: 122.9375)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.5352 -> 131.3750 (注入: 131.3750)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.6094 -> 82.5625 (注入: 82.5625)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.0605 -> 78.0000 (注入: 78.0000)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.6094 -> 132.0000 (注入: 132.0000)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.6094 -> 79.2500 (注入: 79.2500)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.1074 -> 76.8125 (注入: 76.8125)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.9648 -> 70.7500 (注入: 70.7500)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.1055 -> 131.7500 (注入: 131.7500)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.0176 -> 77.5625 (注入: 77.5625)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.8926 -> 71.6250 (注入: 71.6250)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.0859 -> 116.6250 (注入: 116.6250)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 2.6094 -> 78.4375 (注入: 78.4375)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.2891 -> 122.9375 (注入: 122.9375)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.7500 -> 79.6875 (注入: 79.6875)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.8086 -> 77.0000 (注入: 77.0000)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.0098 -> 71.5625 (注入: 71.5625)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.6738 -> 126.5000 (注入: 126.5000)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.6094 -> 72.0625 (注入: 72.0625)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 2.9258 -> 122.9375 (注入: 122.9375)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.0078 -> 79.8750 (注入: 79.8750)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 2.6094 -> 74.2500 (注入: 74.2500)
層1の隠れ状態変化: MSE=0.000000
成功: 層1の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 2.8828 -> 78.9375 (注入: 78.9375)
層1の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([1]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層1の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.1211 -> 70.5625 (注入: 70.5625)
層1の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層1の精度: 0.0000
Debug: 実験進行状況: [=                   ] 6.2% (層 3/32, 現在: 2)
Debug: 層2のテスト中...
Debug: modulated_generate開始 (層=2)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.9512 -> 76.5000 (注入: 76.5000)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.5488 -> 122.9375 (注入: 122.9375)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.8125 -> 131.3750 (注入: 131.3750)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.9512 -> 82.5625 (注入: 82.5625)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.8965 -> 78.0000 (注入: 78.0000)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.9512 -> 132.0000 (注入: 132.0000)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.9512 -> 79.2500 (注入: 79.2500)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 4.0586 -> 76.8125 (注入: 76.8125)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.7441 -> 70.7500 (注入: 70.7500)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 4.0430 -> 131.7500 (注入: 131.7500)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.9004 -> 77.5625 (注入: 77.5625)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.9004 -> 71.6250 (注入: 71.6250)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.8906 -> 116.6250 (注入: 116.6250)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.9512 -> 78.4375 (注入: 78.4375)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 4.1758 -> 122.9375 (注入: 122.9375)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.7266 -> 79.6875 (注入: 79.6875)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.7109 -> 77.0000 (注入: 77.0000)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.8594 -> 71.5625 (注入: 71.5625)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.6270 -> 126.5000 (注入: 126.5000)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.9512 -> 72.0625 (注入: 72.0625)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 3.9199 -> 122.9375 (注入: 122.9375)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 3.9688 -> 79.8750 (注入: 79.8750)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 3.9512 -> 74.2500 (注入: 74.2500)
層2の隠れ状態変化: MSE=0.000000
成功: 層2の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 3.7559 -> 78.9375 (注入: 78.9375)
層2の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([2]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層2の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 4.0508 -> 70.5625 (注入: 70.5625)
層2の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層2の精度: 0.0000
Debug: 実験進行状況: [=                   ] 9.4% (層 4/32, 現在: 3)
Debug: 層3のテスト中...
Debug: modulated_generate開始 (層=3)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.7969 -> 76.5000 (注入: 76.5000)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 4.7070 -> 122.9375 (注入: 122.9375)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 4.6367 -> 131.3750 (注入: 131.3750)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.7969 -> 82.5625 (注入: 82.5625)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.1406 -> 78.0000 (注入: 78.0000)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 5.7969 -> 132.0000 (注入: 132.0000)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.7969 -> 79.2500 (注入: 79.2500)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.2969 -> 76.8125 (注入: 76.8125)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.0000 -> 70.7500 (注入: 70.7500)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 5.1289 -> 131.7500 (注入: 131.7500)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.2734 -> 77.5625 (注入: 77.5625)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.2539 -> 71.6250 (注入: 71.6250)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.2070 -> 116.6250 (注入: 116.6250)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 5.7969 -> 78.4375 (注入: 78.4375)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.4102 -> 122.9375 (注入: 122.9375)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.8047 -> 79.6875 (注入: 79.6875)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 4.8008 -> 77.0000 (注入: 77.0000)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 5.1133 -> 71.5625 (注入: 71.5625)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.3672 -> 126.5000 (注入: 126.5000)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.7969 -> 72.0625 (注入: 72.0625)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.2109 -> 122.9375 (注入: 122.9375)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 5.2070 -> 79.8750 (注入: 79.8750)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.7969 -> 74.2500 (注入: 74.2500)
層3の隠れ状態変化: MSE=0.000000
成功: 層3の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 5.2695 -> 78.9375 (注入: 78.9375)
層3の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([3]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層3の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 5.3281 -> 70.5625 (注入: 70.5625)
層3の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層3の精度: 0.0000
Debug: 実験進行状況: [==                  ] 12.5% (層 5/32, 現在: 4)
Debug: 層4のテスト中...
Debug: modulated_generate開始 (層=4)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.2812 -> 76.5000 (注入: 76.5000)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 6.6211 -> 122.9375 (注入: 122.9375)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 5.8320 -> 131.3750 (注入: 131.3750)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 7.2812 -> 82.5625 (注入: 82.5625)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.0664 -> 78.0000 (注入: 78.0000)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 7.2812 -> 132.0000 (注入: 132.0000)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 7.2812 -> 79.2500 (注入: 79.2500)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 6.7891 -> 76.8125 (注入: 76.8125)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.1172 -> 70.7500 (注入: 70.7500)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 6.8320 -> 131.7500 (注入: 131.7500)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 6.6992 -> 77.5625 (注入: 77.5625)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 7.1055 -> 71.6250 (注入: 71.6250)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 6.7578 -> 116.6250 (注入: 116.6250)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 7.2812 -> 78.4375 (注入: 78.4375)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 7.3125 -> 122.9375 (注入: 122.9375)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 7.7930 -> 79.6875 (注入: 79.6875)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 6.4648 -> 77.0000 (注入: 77.0000)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 6.9258 -> 71.5625 (注入: 71.5625)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 8.0156 -> 126.5000 (注入: 126.5000)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 7.2812 -> 72.0625 (注入: 72.0625)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.8164 -> 122.9375 (注入: 122.9375)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 6.8438 -> 79.8750 (注入: 79.8750)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 7.2812 -> 74.2500 (注入: 74.2500)
層4の隠れ状態変化: MSE=0.000000
成功: 層4の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 6.6992 -> 78.9375 (注入: 78.9375)
層4の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([4]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層4の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.2344 -> 70.5625 (注入: 70.5625)
層4の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層4の精度: 0.0400
Debug: 実験進行状況: [===                 ] 15.6% (層 6/32, 現在: 5)
Debug: 層5のテスト中...
Debug: modulated_generate開始 (層=5)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 8.3906 -> 76.5000 (注入: 76.5000)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 7.6328 -> 122.9375 (注入: 122.9375)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 7.8359 -> 131.3750 (注入: 131.3750)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 8.3906 -> 82.5625 (注入: 82.5625)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 8.3203 -> 78.0000 (注入: 78.0000)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.3906 -> 132.0000 (注入: 132.0000)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 8.3906 -> 79.2500 (注入: 79.2500)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 8.1328 -> 76.8125 (注入: 76.8125)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 8.3828 -> 70.7500 (注入: 70.7500)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.1484 -> 131.7500 (注入: 131.7500)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 8.2422 -> 77.5625 (注入: 77.5625)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 8.3125 -> 71.6250 (注入: 71.6250)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 8.3438 -> 116.6250 (注入: 116.6250)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.3906 -> 78.4375 (注入: 78.4375)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 9.0000 -> 122.9375 (注入: 122.9375)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.2891 -> 79.6875 (注入: 79.6875)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 7.8789 -> 77.0000 (注入: 77.0000)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.4531 -> 71.5625 (注入: 71.5625)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 9.6719 -> 126.5000 (注入: 126.5000)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 8.3906 -> 72.0625 (注入: 72.0625)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.3906 -> 122.9375 (注入: 122.9375)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.2031 -> 79.8750 (注入: 79.8750)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 8.3906 -> 74.2500 (注入: 74.2500)
層5の隠れ状態変化: MSE=0.000000
成功: 層5の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 8.0234 -> 78.9375 (注入: 78.9375)
層5の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([5]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層5の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 8.5391 -> 70.5625 (注入: 70.5625)
層5の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層5の精度: 0.0400
Debug: 実験進行状況: [===                 ] 18.8% (層 7/32, 現在: 6)
Debug: 層6のテスト中...
Debug: modulated_generate開始 (層=6)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.2812 -> 76.5000 (注入: 76.5000)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 8.9453 -> 122.9375 (注入: 122.9375)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 10.1094 -> 131.3750 (注入: 131.3750)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.2812 -> 82.5625 (注入: 82.5625)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.7188 -> 78.0000 (注入: 78.0000)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 9.2812 -> 132.0000 (注入: 132.0000)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 9.2812 -> 79.2500 (注入: 79.2500)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.2031 -> 76.8125 (注入: 76.8125)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.8203 -> 70.7500 (注入: 70.7500)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 9.5469 -> 131.7500 (注入: 131.7500)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 9.5000 -> 77.5625 (注入: 77.5625)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.4297 -> 71.6250 (注入: 71.6250)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.7422 -> 116.6250 (注入: 116.6250)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 9.2812 -> 78.4375 (注入: 78.4375)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 10.4062 -> 122.9375 (注入: 122.9375)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.8672 -> 79.6875 (注入: 79.6875)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.0703 -> 77.0000 (注入: 77.0000)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.0312 -> 71.5625 (注入: 71.5625)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 11.1016 -> 126.5000 (注入: 126.5000)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.2812 -> 72.0625 (注入: 72.0625)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 10.3672 -> 122.9375 (注入: 122.9375)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 9.7031 -> 79.8750 (注入: 79.8750)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 9.2812 -> 74.2500 (注入: 74.2500)
層6の隠れ状態変化: MSE=0.000000
成功: 層6の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 9.2266 -> 78.9375 (注入: 78.9375)
層6の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([6]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層6の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 9.8672 -> 70.5625 (注入: 70.5625)
層6の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層6の精度: 0.0400
Debug: 実験進行状況: [====                ] 21.9% (層 8/32, 現在: 7)
Debug: 層7のテスト中...
Debug: modulated_generate開始 (層=7)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 10.0391 -> 76.5000 (注入: 76.5000)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.3125 -> 122.9375 (注入: 122.9375)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 12.3828 -> 131.3750 (注入: 131.3750)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.0391 -> 82.5625 (注入: 82.5625)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.3516 -> 78.0000 (注入: 78.0000)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.0391 -> 132.0000 (注入: 132.0000)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 10.0391 -> 79.2500 (注入: 79.2500)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.7500 -> 76.8125 (注入: 76.8125)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.8906 -> 70.7500 (注入: 70.7500)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.9531 -> 131.7500 (注入: 131.7500)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 10.8516 -> 77.5625 (注入: 77.5625)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.6719 -> 71.6250 (注入: 71.6250)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 10.7188 -> 116.6250 (注入: 116.6250)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.0391 -> 78.4375 (注入: 78.4375)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 11.8438 -> 122.9375 (注入: 122.9375)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 12.8281 -> 79.6875 (注入: 79.6875)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 10.4766 -> 77.0000 (注入: 77.0000)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 12.4688 -> 71.5625 (注入: 71.5625)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 12.0078 -> 126.5000 (注入: 126.5000)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.0391 -> 72.0625 (注入: 72.0625)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 12.1172 -> 122.9375 (注入: 122.9375)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 10.8750 -> 79.8750 (注入: 79.8750)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 10.0391 -> 74.2500 (注入: 74.2500)
層7の隠れ状態変化: MSE=0.000000
成功: 層7の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 10.8750 -> 78.9375 (注入: 78.9375)
層7の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([7]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層7の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 10.6719 -> 70.5625 (注入: 70.5625)
層7の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層7の精度: 0.0400
Debug: 実験進行状況: [=====               ] 25.0% (層 9/32, 現在: 8)
Debug: 層8のテスト中...
Debug: modulated_generate開始 (層=8)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.9453 -> 76.5000 (注入: 76.5000)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 12.0078 -> 122.9375 (注入: 122.9375)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 13.2734 -> 131.3750 (注入: 131.3750)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 11.9453 -> 82.5625 (注入: 82.5625)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 12.5234 -> 78.0000 (注入: 78.0000)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 11.9453 -> 132.0000 (注入: 132.0000)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 11.9453 -> 79.2500 (注入: 79.2500)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 11.3984 -> 76.8125 (注入: 76.8125)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 13.6016 -> 70.7500 (注入: 70.7500)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 11.7266 -> 131.7500 (注入: 131.7500)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 11.9922 -> 77.5625 (注入: 77.5625)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 11.3828 -> 71.6250 (注入: 71.6250)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.5234 -> 116.6250 (注入: 116.6250)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 11.9453 -> 78.4375 (注入: 78.4375)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 13.0469 -> 122.9375 (注入: 122.9375)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 14.5781 -> 79.6875 (注入: 79.6875)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.8125 -> 77.0000 (注入: 77.0000)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 13.9766 -> 71.5625 (注入: 71.5625)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 12.6562 -> 126.5000 (注入: 126.5000)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 11.9453 -> 72.0625 (注入: 72.0625)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 13.6406 -> 122.9375 (注入: 122.9375)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 11.5859 -> 79.8750 (注入: 79.8750)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 11.9453 -> 74.2500 (注入: 74.2500)
層8の隠れ状態変化: MSE=0.000000
成功: 層8の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 12.3750 -> 78.9375 (注入: 78.9375)
層8の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([8]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層8の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 11.7109 -> 70.5625 (注入: 70.5625)
層8の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層8の精度: 0.0400
Debug: 実験進行状況: [=====               ] 28.1% (層 10/32, 現在: 9)
Debug: 層9のテスト中...
Debug: modulated_generate開始 (層=9)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 14.4375 -> 76.5000 (注入: 76.5000)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 13.7578 -> 122.9375 (注入: 122.9375)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 14.4141 -> 131.3750 (注入: 131.3750)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 14.4375 -> 82.5625 (注入: 82.5625)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 14.1953 -> 78.0000 (注入: 78.0000)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 14.4375 -> 132.0000 (注入: 132.0000)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 14.4375 -> 79.2500 (注入: 79.2500)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 13.2969 -> 76.8125 (注入: 76.8125)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.0703 -> 70.7500 (注入: 70.7500)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 13.2188 -> 131.7500 (注入: 131.7500)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 13.7031 -> 77.5625 (注入: 77.5625)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 13.1016 -> 71.6250 (注入: 71.6250)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 12.9844 -> 116.6250 (注入: 116.6250)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 14.4375 -> 78.4375 (注入: 78.4375)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 14.3594 -> 122.9375 (注入: 122.9375)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 16.1875 -> 79.6875 (注入: 79.6875)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 13.7734 -> 77.0000 (注入: 77.0000)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.6328 -> 71.5625 (注入: 71.5625)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 14.3672 -> 126.5000 (注入: 126.5000)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 14.4375 -> 72.0625 (注入: 72.0625)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.2656 -> 122.9375 (注入: 122.9375)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 12.7812 -> 79.8750 (注入: 79.8750)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 14.4375 -> 74.2500 (注入: 74.2500)
層9の隠れ状態変化: MSE=0.000000
成功: 層9の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 13.8281 -> 78.9375 (注入: 78.9375)
層9の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([9]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層9の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 13.1328 -> 70.5625 (注入: 70.5625)
層9の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層9の精度: 0.0400
Debug: 実験進行状況: [======              ] 31.2% (層 11/32, 現在: 10)
Debug: 層10のテスト中...
Debug: modulated_generate開始 (層=10)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.7969 -> 76.5000 (注入: 76.5000)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.7109 -> 122.9375 (注入: 122.9375)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.8906 -> 131.3750 (注入: 131.3750)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 15.7969 -> 82.5625 (注入: 82.5625)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.7266 -> 78.0000 (注入: 78.0000)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.7969 -> 132.0000 (注入: 132.0000)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.7969 -> 79.2500 (注入: 79.2500)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 15.2266 -> 76.8125 (注入: 76.8125)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 17.0938 -> 70.7500 (注入: 70.7500)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 14.9375 -> 131.7500 (注入: 131.7500)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.3984 -> 77.5625 (注入: 77.5625)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 14.6953 -> 71.6250 (注入: 71.6250)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 14.5469 -> 116.6250 (注入: 116.6250)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.7969 -> 78.4375 (注入: 78.4375)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.8516 -> 122.9375 (注入: 122.9375)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 18.0000 -> 79.6875 (注入: 79.6875)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.1641 -> 77.0000 (注入: 77.0000)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 17.5312 -> 71.5625 (注入: 71.5625)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.3281 -> 126.5000 (注入: 126.5000)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 15.7969 -> 72.0625 (注入: 72.0625)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 17.0156 -> 122.9375 (注入: 122.9375)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 14.4688 -> 79.8750 (注入: 79.8750)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 15.7969 -> 74.2500 (注入: 74.2500)
層10の隠れ状態変化: MSE=0.000000
成功: 層10の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 15.3828 -> 78.9375 (注入: 78.9375)
層10の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([10]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層10の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 14.7500 -> 70.5625 (注入: 70.5625)
層10の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層10の精度: 0.0800
Debug: 実験進行状況: [======              ] 34.4% (層 12/32, 現在: 11)
Debug: 層11のテスト中...
Debug: modulated_generate開始 (層=11)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 16.7188 -> 76.5000 (注入: 76.5000)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 16.8750 -> 122.9375 (注入: 122.9375)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 17.3281 -> 131.3750 (注入: 131.3750)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 16.7188 -> 82.5625 (注入: 82.5625)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 17.1719 -> 78.0000 (注入: 78.0000)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 16.7188 -> 132.0000 (注入: 132.0000)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 16.7188 -> 79.2500 (注入: 79.2500)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 16.3281 -> 76.8125 (注入: 76.8125)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.7344 -> 70.7500 (注入: 70.7500)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.9219 -> 131.7500 (注入: 131.7500)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 16.7188 -> 77.5625 (注入: 77.5625)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 15.9922 -> 71.6250 (注入: 71.6250)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 15.5000 -> 116.6250 (注入: 116.6250)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 16.7188 -> 78.4375 (注入: 78.4375)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.0469 -> 122.9375 (注入: 122.9375)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 19.8125 -> 79.6875 (注入: 79.6875)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 17.0312 -> 77.0000 (注入: 77.0000)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 19.1719 -> 71.5625 (注入: 71.5625)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 16.1406 -> 126.5000 (注入: 126.5000)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 16.7188 -> 72.0625 (注入: 72.0625)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 17.7500 -> 122.9375 (注入: 122.9375)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 15.4062 -> 79.8750 (注入: 79.8750)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 16.7188 -> 74.2500 (注入: 74.2500)
層11の隠れ状態変化: MSE=0.000000
成功: 層11の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 16.8281 -> 78.9375 (注入: 78.9375)
層11の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([11]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層11の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 16.0938 -> 70.5625 (注入: 70.5625)
層11の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層11の精度: 0.0800
Debug: 実験進行状況: [=======             ] 37.5% (層 13/32, 現在: 12)
Debug: 層12のテスト中...
Debug: modulated_generate開始 (層=12)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.0312 -> 76.5000 (注入: 76.5000)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 19.1875 -> 122.9375 (注入: 122.9375)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.2969 -> 131.3750 (注入: 131.3750)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 18.0312 -> 82.5625 (注入: 82.5625)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.2031 -> 78.0000 (注入: 78.0000)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 18.0312 -> 132.0000 (注入: 132.0000)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.0312 -> 79.2500 (注入: 79.2500)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 17.7188 -> 76.8125 (注入: 76.8125)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 20.2969 -> 70.7500 (注入: 70.7500)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 17.1250 -> 131.7500 (注入: 131.7500)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.0312 -> 77.5625 (注入: 77.5625)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 17.3438 -> 71.6250 (注入: 71.6250)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 16.8125 -> 116.6250 (注入: 116.6250)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 18.0312 -> 78.4375 (注入: 78.4375)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 19.0781 -> 122.9375 (注入: 122.9375)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 21.1562 -> 79.6875 (注入: 79.6875)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.0625 -> 77.0000 (注入: 77.0000)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 20.6250 -> 71.5625 (注入: 71.5625)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 17.9062 -> 126.5000 (注入: 126.5000)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 18.0312 -> 72.0625 (注入: 72.0625)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.4688 -> 122.9375 (注入: 122.9375)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 17.3281 -> 79.8750 (注入: 79.8750)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.0312 -> 74.2500 (注入: 74.2500)
層12の隠れ状態変化: MSE=0.000000
成功: 層12の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 18.8750 -> 78.9375 (注入: 78.9375)
層12の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([12]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層12の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.0000 -> 70.5625 (注入: 70.5625)
層12の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層12の精度: 0.0400
Debug: 実験進行状況: [========            ] 40.6% (層 14/32, 現在: 13)
Debug: 層13のテスト中...
Debug: modulated_generate開始 (層=13)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 19.6406 -> 76.5000 (注入: 76.5000)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 21.1250 -> 122.9375 (注入: 122.9375)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 19.3281 -> 131.3750 (注入: 131.3750)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 19.6406 -> 82.5625 (注入: 82.5625)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 19.5625 -> 78.0000 (注入: 78.0000)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 19.6406 -> 132.0000 (注入: 132.0000)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 19.6406 -> 79.2500 (注入: 79.2500)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 19.2969 -> 76.8125 (注入: 76.8125)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 22.2344 -> 70.7500 (注入: 70.7500)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 19.2031 -> 131.7500 (注入: 131.7500)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 21.4844 -> 77.5625 (注入: 77.5625)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 18.7344 -> 71.6250 (注入: 71.6250)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 18.5156 -> 116.6250 (注入: 116.6250)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 19.6406 -> 78.4375 (注入: 78.4375)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 20.6406 -> 122.9375 (注入: 122.9375)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 22.9531 -> 79.6875 (注入: 79.6875)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 21.0625 -> 77.0000 (注入: 77.0000)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 24.3281 -> 71.5625 (注入: 71.5625)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 18.8281 -> 126.5000 (注入: 126.5000)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 19.6406 -> 72.0625 (注入: 72.0625)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 20.7969 -> 122.9375 (注入: 122.9375)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 18.5938 -> 79.8750 (注入: 79.8750)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 19.6406 -> 74.2500 (注入: 74.2500)
層13の隠れ状態変化: MSE=0.000000
成功: 層13の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 20.8281 -> 78.9375 (注入: 78.9375)
層13の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([13]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層13の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 19.0156 -> 70.5625 (注入: 70.5625)
層13の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層13の精度: 0.0800
Debug: 実験進行状況: [========            ] 43.8% (層 15/32, 現在: 14)
Debug: 層14のテスト中...
Debug: modulated_generate開始 (層=14)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 21.6250 -> 76.5000 (注入: 76.5000)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 23.2656 -> 122.9375 (注入: 122.9375)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 20.9219 -> 131.3750 (注入: 131.3750)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 21.6250 -> 82.5625 (注入: 82.5625)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 21.6406 -> 78.0000 (注入: 78.0000)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 21.6250 -> 132.0000 (注入: 132.0000)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 21.6250 -> 79.2500 (注入: 79.2500)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 21.8906 -> 76.8125 (注入: 76.8125)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 25.5312 -> 70.7500 (注入: 70.7500)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 21.4375 -> 131.7500 (注入: 131.7500)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 23.5312 -> 77.5625 (注入: 77.5625)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 21.7344 -> 71.6250 (注入: 71.6250)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 22.4844 -> 116.6250 (注入: 116.6250)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 21.6250 -> 78.4375 (注入: 78.4375)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 24.2188 -> 122.9375 (注入: 122.9375)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 26.5000 -> 79.6875 (注入: 79.6875)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 23.1406 -> 77.0000 (注入: 77.0000)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 27.0781 -> 71.5625 (注入: 71.5625)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 21.2500 -> 126.5000 (注入: 126.5000)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 21.6250 -> 72.0625 (注入: 72.0625)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 22.9844 -> 122.9375 (注入: 122.9375)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 20.8281 -> 79.8750 (注入: 79.8750)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 21.6250 -> 74.2500 (注入: 74.2500)
層14の隠れ状態変化: MSE=0.000000
成功: 層14の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 23.3594 -> 78.9375 (注入: 78.9375)
層14の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([14]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層14の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 23.7812 -> 70.5625 (注入: 70.5625)
層14の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層14の精度: 0.0800
Debug: 実験進行状況: [=========           ] 46.9% (層 16/32, 現在: 15)
Debug: 層15のテスト中...
Debug: modulated_generate開始 (層=15)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 26.0625 -> 76.5000 (注入: 76.5000)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 27.1406 -> 122.9375 (注入: 122.9375)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 26.2188 -> 131.3750 (注入: 131.3750)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 26.0625 -> 82.5625 (注入: 82.5625)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 29.1094 -> 78.0000 (注入: 78.0000)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 26.0625 -> 132.0000 (注入: 132.0000)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 26.0625 -> 79.2500 (注入: 79.2500)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 25.9844 -> 76.8125 (注入: 76.8125)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 29.4062 -> 70.7500 (注入: 70.7500)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 24.2031 -> 131.7500 (注入: 131.7500)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 26.5938 -> 77.5625 (注入: 77.5625)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 25.8906 -> 71.6250 (注入: 71.6250)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 25.5000 -> 116.6250 (注入: 116.6250)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 26.0625 -> 78.4375 (注入: 78.4375)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 29.0000 -> 122.9375 (注入: 122.9375)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 30.5469 -> 79.6875 (注入: 79.6875)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 27.7500 -> 77.0000 (注入: 77.0000)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 31.1094 -> 71.5625 (注入: 71.5625)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 24.6719 -> 126.5000 (注入: 126.5000)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 26.0625 -> 72.0625 (注入: 72.0625)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 28.4688 -> 122.9375 (注入: 122.9375)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 25.0156 -> 79.8750 (注入: 79.8750)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 26.0625 -> 74.2500 (注入: 74.2500)
層15の隠れ状態変化: MSE=0.000000
成功: 層15の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 27.5156 -> 78.9375 (注入: 78.9375)
層15の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([15]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層15の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 25.5000 -> 70.5625 (注入: 70.5625)
層15の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層15の精度: 0.1200
Debug: 実験進行状況: [==========          ] 50.0% (層 17/32, 現在: 16)
Debug: 層16のテスト中...
Debug: modulated_generate開始 (層=16)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 30.3594 -> 76.5000 (注入: 76.5000)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 31.1094 -> 122.9375 (注入: 122.9375)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 29.6562 -> 131.3750 (注入: 131.3750)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 30.3594 -> 82.5625 (注入: 82.5625)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 33.6250 -> 78.0000 (注入: 78.0000)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 30.3594 -> 132.0000 (注入: 132.0000)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 30.3594 -> 79.2500 (注入: 79.2500)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 32.5000 -> 76.8125 (注入: 76.8125)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 34.8438 -> 70.7500 (注入: 70.7500)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 32.3125 -> 131.7500 (注入: 131.7500)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 31.4062 -> 77.5625 (注入: 77.5625)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 29.7031 -> 71.6250 (注入: 71.6250)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 30.1719 -> 116.6250 (注入: 116.6250)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 30.3594 -> 78.4375 (注入: 78.4375)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 34.5625 -> 122.9375 (注入: 122.9375)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 33.6875 -> 79.6875 (注入: 79.6875)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 31.7188 -> 77.0000 (注入: 77.0000)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 35.2188 -> 71.5625 (注入: 71.5625)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 29.5000 -> 126.5000 (注入: 126.5000)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 30.3594 -> 72.0625 (注入: 72.0625)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 32.9062 -> 122.9375 (注入: 122.9375)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 29.3906 -> 79.8750 (注入: 79.8750)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 30.3594 -> 74.2500 (注入: 74.2500)
層16の隠れ状態変化: MSE=0.000000
成功: 層16の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 32.5938 -> 78.9375 (注入: 78.9375)
層16の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([16]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層16の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 30.0312 -> 70.5625 (注入: 70.5625)
層16の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層16の精度: 0.1200
Debug: 実験進行状況: [==========          ] 53.1% (層 18/32, 現在: 17)
Debug: 層17のテスト中...
Debug: modulated_generate開始 (層=17)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 35.1875 -> 76.5000 (注入: 76.5000)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 35.6875 -> 122.9375 (注入: 122.9375)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 30.8281 -> 131.3750 (注入: 131.3750)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 35.1875 -> 82.5625 (注入: 82.5625)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 36.7188 -> 78.0000 (注入: 78.0000)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 35.1875 -> 132.0000 (注入: 132.0000)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 35.1875 -> 79.2500 (注入: 79.2500)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 36.5312 -> 76.8125 (注入: 76.8125)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 37.4375 -> 70.7500 (注入: 70.7500)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 37.3438 -> 131.7500 (注入: 131.7500)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 37.0938 -> 77.5625 (注入: 77.5625)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 36.2188 -> 71.6250 (注入: 71.6250)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 34.0000 -> 116.6250 (注入: 116.6250)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 35.1875 -> 78.4375 (注入: 78.4375)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 38.3750 -> 122.9375 (注入: 122.9375)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 36.3750 -> 79.6875 (注入: 79.6875)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 35.0312 -> 77.0000 (注入: 77.0000)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 38.6562 -> 71.5625 (注入: 71.5625)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 34.0938 -> 126.5000 (注入: 126.5000)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 35.1875 -> 72.0625 (注入: 72.0625)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 36.0938 -> 122.9375 (注入: 122.9375)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 35.8750 -> 79.8750 (注入: 79.8750)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 35.1875 -> 74.2500 (注入: 74.2500)
層17の隠れ状態変化: MSE=0.000000
成功: 層17の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 39.4375 -> 78.9375 (注入: 78.9375)
層17の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([17]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層17の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 34.1250 -> 70.5625 (注入: 70.5625)
層17の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層17の精度: 0.0400
Debug: 実験進行状況: [===========         ] 56.2% (層 19/32, 現在: 18)
Debug: 層18のテスト中...
Debug: modulated_generate開始 (層=18)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 41.5625 -> 76.5000 (注入: 76.5000)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 39.7812 -> 122.9375 (注入: 122.9375)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 34.6875 -> 131.3750 (注入: 131.3750)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 41.5625 -> 82.5625 (注入: 82.5625)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 41.5000 -> 78.0000 (注入: 78.0000)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 41.5625 -> 132.0000 (注入: 132.0000)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 41.5625 -> 79.2500 (注入: 79.2500)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 42.7500 -> 76.8125 (注入: 76.8125)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 41.5000 -> 70.7500 (注入: 70.7500)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 41.6562 -> 131.7500 (注入: 131.7500)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 41.8750 -> 77.5625 (注入: 77.5625)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 42.0000 -> 71.6250 (注入: 71.6250)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 42.2188 -> 116.6250 (注入: 116.6250)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 41.5625 -> 78.4375 (注入: 78.4375)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 42.6562 -> 122.9375 (注入: 122.9375)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 42.5938 -> 79.6875 (注入: 79.6875)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 40.5000 -> 77.0000 (注入: 77.0000)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 44.6562 -> 71.5625 (注入: 71.5625)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 37.7812 -> 126.5000 (注入: 126.5000)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 41.5625 -> 72.0625 (注入: 72.0625)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 41.6875 -> 122.9375 (注入: 122.9375)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 42.3438 -> 79.8750 (注入: 79.8750)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 41.5625 -> 74.2500 (注入: 74.2500)
層18の隠れ状態変化: MSE=0.000000
成功: 層18の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 44.5938 -> 78.9375 (注入: 78.9375)
層18の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([18]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層18の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 40.6250 -> 70.5625 (注入: 70.5625)
層18の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層18の精度: 0.0000
Debug: 実験進行状況: [===========         ] 59.4% (層 20/32, 現在: 19)
Debug: 層19のテスト中...
Debug: modulated_generate開始 (層=19)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 48.2188 -> 76.5000 (注入: 76.5000)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 44.6250 -> 122.9375 (注入: 122.9375)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 38.0625 -> 131.3750 (注入: 131.3750)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 48.2188 -> 82.5625 (注入: 82.5625)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 49.1875 -> 78.0000 (注入: 78.0000)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 48.2188 -> 132.0000 (注入: 132.0000)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 48.2188 -> 79.2500 (注入: 79.2500)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 49.9062 -> 76.8125 (注入: 76.8125)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 45.5938 -> 70.7500 (注入: 70.7500)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 49.8750 -> 131.7500 (注入: 131.7500)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 48.8750 -> 77.5625 (注入: 77.5625)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 48.4062 -> 71.6250 (注入: 71.6250)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 48.7500 -> 116.6250 (注入: 116.6250)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 48.2188 -> 78.4375 (注入: 78.4375)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 47.8438 -> 122.9375 (注入: 122.9375)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 46.1250 -> 79.6875 (注入: 79.6875)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 47.0000 -> 77.0000 (注入: 77.0000)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 49.1562 -> 71.5625 (注入: 71.5625)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 44.1875 -> 126.5000 (注入: 126.5000)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 48.2188 -> 72.0625 (注入: 72.0625)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 47.5000 -> 122.9375 (注入: 122.9375)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 50.4375 -> 79.8750 (注入: 79.8750)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 48.2188 -> 74.2500 (注入: 74.2500)
層19の隠れ状態変化: MSE=0.000000
成功: 層19の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 51.5625 -> 78.9375 (注入: 78.9375)
層19の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([19]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層19の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 46.5938 -> 70.5625 (注入: 70.5625)
層19の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層19の精度: 0.1600
Debug: 実験進行状況: [============        ] 62.5% (層 21/32, 現在: 20)
Debug: 層20のテスト中...
Debug: modulated_generate開始 (層=20)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 54.0312 -> 76.5000 (注入: 76.5000)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 51.2812 -> 122.9375 (注入: 122.9375)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 41.5938 -> 131.3750 (注入: 131.3750)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 54.0312 -> 82.5625 (注入: 82.5625)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 54.1562 -> 78.0000 (注入: 78.0000)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 54.0312 -> 132.0000 (注入: 132.0000)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 54.0312 -> 79.2500 (注入: 79.2500)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 57.4062 -> 76.8125 (注入: 76.8125)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 50.7500 -> 70.7500 (注入: 70.7500)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 58.1562 -> 131.7500 (注入: 131.7500)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 57.6250 -> 77.5625 (注入: 77.5625)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 60.6875 -> 71.6250 (注入: 71.6250)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 56.0938 -> 116.6250 (注入: 116.6250)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 54.0312 -> 78.4375 (注入: 78.4375)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 55.9375 -> 122.9375 (注入: 122.9375)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 54.2188 -> 79.6875 (注入: 79.6875)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 52.6250 -> 77.0000 (注入: 77.0000)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 54.4688 -> 71.5625 (注入: 71.5625)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 49.4688 -> 126.5000 (注入: 126.5000)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 54.0312 -> 72.0625 (注入: 72.0625)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 54.0625 -> 122.9375 (注入: 122.9375)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 56.9062 -> 79.8750 (注入: 79.8750)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 54.0312 -> 74.2500 (注入: 74.2500)
層20の隠れ状態変化: MSE=0.000000
成功: 層20の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 57.3438 -> 78.9375 (注入: 78.9375)
層20の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([20]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層20の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 52.3750 -> 70.5625 (注入: 70.5625)
層20の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層20の精度: 0.1200
Debug: 実験進行状況: [=============       ] 65.6% (層 22/32, 現在: 21)
Debug: 層21のテスト中...
Debug: modulated_generate開始 (層=21)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 60.7188 -> 76.5000 (注入: 76.5000)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 55.5625 -> 122.9375 (注入: 122.9375)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 46.0625 -> 131.3750 (注入: 131.3750)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 60.7188 -> 82.5625 (注入: 82.5625)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 59.0625 -> 78.0000 (注入: 78.0000)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 60.7188 -> 132.0000 (注入: 132.0000)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 60.7188 -> 79.2500 (注入: 79.2500)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 64.9375 -> 76.8125 (注入: 76.8125)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 56.0312 -> 70.7500 (注入: 70.7500)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 65.1250 -> 131.7500 (注入: 131.7500)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 63.3750 -> 77.5625 (注入: 77.5625)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 67.3750 -> 71.6250 (注入: 71.6250)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 62.0625 -> 116.6250 (注入: 116.6250)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 60.7188 -> 78.4375 (注入: 78.4375)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 61.0000 -> 122.9375 (注入: 122.9375)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 59.2188 -> 79.6875 (注入: 79.6875)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 57.1562 -> 77.0000 (注入: 77.0000)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 58.5000 -> 71.5625 (注入: 71.5625)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 54.7812 -> 126.5000 (注入: 126.5000)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 60.7188 -> 72.0625 (注入: 72.0625)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 59.5000 -> 122.9375 (注入: 122.9375)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 64.6875 -> 79.8750 (注入: 79.8750)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 60.7188 -> 74.2500 (注入: 74.2500)
層21の隠れ状態変化: MSE=0.000000
成功: 層21の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 62.8438 -> 78.9375 (注入: 78.9375)
層21の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([21]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層21の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 57.3750 -> 70.5625 (注入: 70.5625)
層21の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層21の精度: 0.0800
Debug: 実験進行状況: [=============       ] 68.8% (層 23/32, 現在: 22)
Debug: 層22のテスト中...
Debug: modulated_generate開始 (層=22)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 68.1875 -> 76.5000 (注入: 76.5000)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 59.7812 -> 122.9375 (注入: 122.9375)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 50.3125 -> 131.3750 (注入: 131.3750)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 68.1875 -> 82.5625 (注入: 82.5625)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 63.7812 -> 78.0000 (注入: 78.0000)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 68.1875 -> 132.0000 (注入: 132.0000)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 68.1875 -> 79.2500 (注入: 79.2500)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 74.0625 -> 76.8125 (注入: 76.8125)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 61.2812 -> 70.7500 (注入: 70.7500)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 72.0000 -> 131.7500 (注入: 131.7500)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 68.4375 -> 77.5625 (注入: 77.5625)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 73.7500 -> 71.6250 (注入: 71.6250)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 67.6875 -> 116.6250 (注入: 116.6250)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 68.1875 -> 78.4375 (注入: 78.4375)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 67.6875 -> 122.9375 (注入: 122.9375)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 62.8750 -> 79.6875 (注入: 79.6875)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 61.3438 -> 77.0000 (注入: 77.0000)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 63.1562 -> 71.5625 (注入: 71.5625)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 61.5938 -> 126.5000 (注入: 126.5000)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 68.1875 -> 72.0625 (注入: 72.0625)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 64.1875 -> 122.9375 (注入: 122.9375)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 71.8125 -> 79.8750 (注入: 79.8750)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 68.1875 -> 74.2500 (注入: 74.2500)
層22の隠れ状態変化: MSE=0.000000
成功: 層22の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 68.5625 -> 78.9375 (注入: 78.9375)
層22の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([22]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層22の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 62.2812 -> 70.5625 (注入: 70.5625)
層22の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層22の精度: 0.1200
Debug: 実験進行状況: [==============      ] 71.9% (層 24/32, 現在: 23)
Debug: 層23のテスト中...
Debug: modulated_generate開始 (層=23)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 72.8125 -> 76.5000 (注入: 76.5000)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 65.3750 -> 122.9375 (注入: 122.9375)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 53.8750 -> 131.3750 (注入: 131.3750)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 72.8125 -> 82.5625 (注入: 82.5625)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 69.3125 -> 78.0000 (注入: 78.0000)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 72.8125 -> 132.0000 (注入: 132.0000)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 72.8125 -> 79.2500 (注入: 79.2500)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 82.4375 -> 76.8125 (注入: 76.8125)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 66.1250 -> 70.7500 (注入: 70.7500)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 77.8750 -> 131.7500 (注入: 131.7500)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 73.2500 -> 77.5625 (注入: 77.5625)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 78.8125 -> 71.6250 (注入: 71.6250)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 73.4375 -> 116.6250 (注入: 116.6250)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 72.8125 -> 78.4375 (注入: 78.4375)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 75.6875 -> 122.9375 (注入: 122.9375)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 67.4375 -> 79.6875 (注入: 79.6875)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 67.9375 -> 77.0000 (注入: 77.0000)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 67.1875 -> 71.5625 (注入: 71.5625)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 67.6875 -> 126.5000 (注入: 126.5000)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 72.8125 -> 72.0625 (注入: 72.0625)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 70.7500 -> 122.9375 (注入: 122.9375)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 77.9375 -> 79.8750 (注入: 79.8750)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 72.8125 -> 74.2500 (注入: 74.2500)
層23の隠れ状態変化: MSE=0.000000
成功: 層23の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 74.5625 -> 78.9375 (注入: 78.9375)
層23の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([23]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層23の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 67.3125 -> 70.5625 (注入: 70.5625)
層23の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層23の精度: 0.0800
Debug: 実験進行状況: [===============     ] 75.0% (層 25/32, 現在: 24)
Debug: 層24のテスト中...
Debug: modulated_generate開始 (層=24)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 81.5000 -> 76.5000 (注入: 76.5000)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 71.0000 -> 122.9375 (注入: 122.9375)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 57.0938 -> 131.3750 (注入: 131.3750)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 81.5000 -> 82.5625 (注入: 82.5625)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 75.0000 -> 78.0000 (注入: 78.0000)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 81.5000 -> 132.0000 (注入: 132.0000)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 81.5000 -> 79.2500 (注入: 79.2500)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 89.0000 -> 76.8125 (注入: 76.8125)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 70.1250 -> 70.7500 (注入: 70.7500)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 83.5625 -> 131.7500 (注入: 131.7500)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 76.8750 -> 77.5625 (注入: 77.5625)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 83.5625 -> 71.6250 (注入: 71.6250)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 78.5625 -> 116.6250 (注入: 116.6250)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 81.5000 -> 78.4375 (注入: 78.4375)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 80.8125 -> 122.9375 (注入: 122.9375)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 71.1250 -> 79.6875 (注入: 79.6875)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 73.4375 -> 77.0000 (注入: 77.0000)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 72.5000 -> 71.5625 (注入: 71.5625)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 74.3125 -> 126.5000 (注入: 126.5000)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 81.5000 -> 72.0625 (注入: 72.0625)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 76.4375 -> 122.9375 (注入: 122.9375)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 83.0625 -> 79.8750 (注入: 79.8750)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 81.5000 -> 74.2500 (注入: 74.2500)
層24の隠れ状態変化: MSE=0.000000
成功: 層24の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 78.5625 -> 78.9375 (注入: 78.9375)
層24の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([24]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層24の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 71.1875 -> 70.5625 (注入: 70.5625)
層24の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層24の精度: 0.0400
Debug: 実験進行状況: [===============     ] 78.1% (層 26/32, 現在: 25)
Debug: 層25のテスト中...
Debug: modulated_generate開始 (層=25)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 83.8750 -> 76.5000 (注入: 76.5000)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 73.6250 -> 122.9375 (注入: 122.9375)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 61.6875 -> 131.3750 (注入: 131.3750)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 83.8750 -> 82.5625 (注入: 82.5625)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 79.6875 -> 78.0000 (注入: 78.0000)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 83.8750 -> 132.0000 (注入: 132.0000)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 83.8750 -> 79.2500 (注入: 79.2500)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 95.6875 -> 76.8125 (注入: 76.8125)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 74.2500 -> 70.7500 (注入: 70.7500)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 88.7500 -> 131.7500 (注入: 131.7500)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 84.0625 -> 77.5625 (注入: 77.5625)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 88.8750 -> 71.6250 (注入: 71.6250)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 84.0625 -> 116.6250 (注入: 116.6250)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 83.8750 -> 78.4375 (注入: 78.4375)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 85.1875 -> 122.9375 (注入: 122.9375)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 76.3750 -> 79.6875 (注入: 79.6875)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 77.0000 -> 77.0000 (注入: 77.0000)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 77.1250 -> 71.5625 (注入: 71.5625)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 79.1875 -> 126.5000 (注入: 126.5000)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 83.8750 -> 72.0625 (注入: 72.0625)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 81.8125 -> 122.9375 (注入: 122.9375)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 88.8125 -> 79.8750 (注入: 79.8750)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 83.8750 -> 74.2500 (注入: 74.2500)
層25の隠れ状態変化: MSE=0.000000
成功: 層25の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 83.5000 -> 78.9375 (注入: 78.9375)
層25の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([25]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層25の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 76.0000 -> 70.5625 (注入: 70.5625)
層25の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層25の精度: 0.0400
Debug: 実験進行状況: [================    ] 81.2% (層 27/32, 現在: 26)
Debug: 層26のテスト中...
Debug: modulated_generate開始 (層=26)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 93.4375 -> 76.5000 (注入: 76.5000)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 77.8750 -> 122.9375 (注入: 122.9375)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 64.8125 -> 131.3750 (注入: 131.3750)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 93.4375 -> 82.5625 (注入: 82.5625)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 82.8125 -> 78.0000 (注入: 78.0000)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 93.4375 -> 132.0000 (注入: 132.0000)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 93.4375 -> 79.2500 (注入: 79.2500)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 100.5625 -> 76.8125 (注入: 76.8125)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 77.7500 -> 70.7500 (注入: 70.7500)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 91.4375 -> 131.7500 (注入: 131.7500)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 87.2500 -> 77.5625 (注入: 77.5625)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 91.9375 -> 71.6250 (注入: 71.6250)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 89.5000 -> 116.6250 (注入: 116.6250)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 93.4375 -> 78.4375 (注入: 78.4375)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 89.2500 -> 122.9375 (注入: 122.9375)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 81.7500 -> 79.6875 (注入: 79.6875)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 80.5625 -> 77.0000 (注入: 77.0000)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 81.0625 -> 71.5625 (注入: 71.5625)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 83.3125 -> 126.5000 (注入: 126.5000)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 93.4375 -> 72.0625 (注入: 72.0625)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 85.8125 -> 122.9375 (注入: 122.9375)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 92.5625 -> 79.8750 (注入: 79.8750)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 93.4375 -> 74.2500 (注入: 74.2500)
層26の隠れ状態変化: MSE=0.000000
成功: 層26の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 87.2500 -> 78.9375 (注入: 78.9375)
層26の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([26]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層26の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 78.5625 -> 70.5625 (注入: 70.5625)
層26の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層26の精度: 0.1200
Debug: 実験進行状況: [================    ] 84.4% (層 28/32, 現在: 27)
Debug: 層27のテスト中...
Debug: modulated_generate開始 (層=27)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 98.2500 -> 76.5000 (注入: 76.5000)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 83.1250 -> 122.9375 (注入: 122.9375)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 68.8750 -> 131.3750 (注入: 131.3750)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 98.2500 -> 82.5625 (注入: 82.5625)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 86.0000 -> 78.0000 (注入: 78.0000)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 98.2500 -> 132.0000 (注入: 132.0000)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 98.2500 -> 79.2500 (注入: 79.2500)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 107.8125 -> 76.8125 (注入: 76.8125)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 87.7500 -> 70.7500 (注入: 70.7500)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 96.5625 -> 131.7500 (注入: 131.7500)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 92.8750 -> 77.5625 (注入: 77.5625)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 95.8125 -> 71.6250 (注入: 71.6250)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 94.1250 -> 116.6250 (注入: 116.6250)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 98.2500 -> 78.4375 (注入: 78.4375)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 93.1875 -> 122.9375 (注入: 122.9375)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 87.8750 -> 79.6875 (注入: 79.6875)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 84.4375 -> 77.0000 (注入: 77.0000)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 85.1875 -> 71.5625 (注入: 71.5625)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 87.7500 -> 126.5000 (注入: 126.5000)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 98.2500 -> 72.0625 (注入: 72.0625)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 89.6875 -> 122.9375 (注入: 122.9375)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 97.3125 -> 79.8750 (注入: 79.8750)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 98.2500 -> 74.2500 (注入: 74.2500)
層27の隠れ状態変化: MSE=0.000000
成功: 層27の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 91.2500 -> 78.9375 (注入: 78.9375)
層27の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([27]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層27の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 82.5625 -> 70.5625 (注入: 70.5625)
層27の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層27の精度: 0.2000
Debug: 実験進行状況: [=================   ] 87.5% (層 29/32, 現在: 28)
Debug: 層28のテスト中...
Debug: modulated_generate開始 (層=28)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 104.2500 -> 76.5000 (注入: 76.5000)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 87.1875 -> 122.9375 (注入: 122.9375)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 73.6875 -> 131.3750 (注入: 131.3750)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 104.2500 -> 82.5625 (注入: 82.5625)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 90.5000 -> 78.0000 (注入: 78.0000)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 104.2500 -> 132.0000 (注入: 132.0000)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 104.2500 -> 79.2500 (注入: 79.2500)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 115.1250 -> 76.8125 (注入: 76.8125)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 92.9375 -> 70.7500 (注入: 70.7500)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 102.3125 -> 131.7500 (注入: 131.7500)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 102.9375 -> 77.5625 (注入: 77.5625)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 102.0000 -> 71.6250 (注入: 71.6250)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 98.8125 -> 116.6250 (注入: 116.6250)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 104.2500 -> 78.4375 (注入: 78.4375)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 98.0000 -> 122.9375 (注入: 122.9375)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 93.7500 -> 79.6875 (注入: 79.6875)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 89.6250 -> 77.0000 (注入: 77.0000)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）/opt/conda/conda-bld/pytorch_1729647352509/work/aten/src/ATen/native/cuda/TensorCompare.cu:110: _assert_async_cuda_kernel: block: [0,0,0], thread: [0,0,0] Assertion `probability tensor contains either `inf`, `nan` or element < 0` failed.
Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2223, in generate
    result = self._sample(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 3200, in _sample
    while self._has_unfinished_sequences(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2401, in _has_unfinished_sequences
    elif this_peer_finished:
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.


  ノルム変化: 92.3125 -> 71.5625 (注入: 71.5625)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 92.7500 -> 126.5000 (注入: 126.5000)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 104.2500 -> 72.0625 (注入: 72.0625)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 96.5625 -> 122.9375 (注入: 122.9375)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 103.3750 -> 79.8750 (注入: 79.8750)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 104.2500 -> 74.2500 (注入: 74.2500)
層28の隠れ状態変化: MSE=0.000000
成功: 層28の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 95.8125 -> 78.9375 (注入: 78.9375)
層28の隠れ状態変化: MSE=0.000000
Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([28]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層28の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 87.1875 -> 70.5625 (注入: 70.5625)
層28の隠れ状態変化: MSE=0.000000
Debug: 予測完了、25個の回答を生成
Debug: 層28の精度: 0.0400
Debug: 実験進行状況: [==================  ] 90.6% (層 30/32, 現在: 29)
Debug: 層29のテスト中...
Debug: modulated_generate開始 (層=29)
Debug: モデルのデータ型: torch.float16
Debug: バッチ 1 処理中 (0〜3)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
成功: 層29の位置4に隠れ状態を注入しました（バッチ0）
  ノルム変化: 111.5000 -> 76.5000 (注入: 76.5000)
層29の隠れ状態変化: MSE=0.000000
成功: 層29の位置4に隠れ状態を注入しました（バッチ1）
  ノルム変化: 91.4375 -> 122.9375 (注入: 122.9375)
層29の隠れ状態変化: MSE=0.000000
成功: 層29の位置4に隠れ状態を注入しました（バッチ2）
  ノルム変化: 77.5625 -> 131.3750 (注入: 131.3750)
層29の隠れ状態変化: MSE=0.000000
成功: 層29の位置4に隠れ状態を注入しました（バッチ3）
  ノルム変化: 111.5000 -> 82.5625 (注入: 82.5625)
層29の隠れ状態変化: MSE=0.000000
警告: バッチ0〜3の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 2 処理中 (4〜7)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ4〜7の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 3 処理中 (8〜11)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ8〜11の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 4 処理中 (12〜15)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ12〜15の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 5 処理中 (16〜19)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ16〜19の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 6 処理中 (20〜23)
Debug: バッチの隠れ状態の形状: torch.Size([4, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([4, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 288, in modulated_generate
    outputs = model.generate(
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 2004, in generate
    self._prepare_special_tokens(generation_config, kwargs_has_attention_mask, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1819, in _prepare_special_tokens
    bos_token_tensor = _tensor_or_none(generation_config.bos_token_id, device=device)
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/site-packages/transformers/generation/utils.py", line 1817, in _tensor_or_none
    return torch.tensor(token, device=device, dtype=torch.long)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Traceback (most recent call last):
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "/opt/conda/envs/icl_task_vectors/lib/python3.10/runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "/home/yukaalive/2025workspace/icl_task_vectors/scripts/experiments/main.py", line 210, in <module>
    main()
  File "/home/yukaalive/2025workspace/icl_task_vectors/scripts/experiments/main.py", line 194, in main
    run_main_experiment(model_type, model_variant, experiment_id=experiment_id, 
  File "/home/yukaalive/2025workspace/icl_task_vectors/scripts/experiments/main.py", line 150, in run_main_experiment
    accuracies, tv_ordered_tokens_by_layer = evaluate_task(model, tokenizer, task_name, num_examples)
  File "/home/yukaalive/2025workspace/icl_task_vectors/scripts/experiments/main.py", line 79, in evaluate_task
    tv_predictions, tv_dev_accuracy_by_layer, task_hiddens = run_task_vector(
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 87, in run_task_vector
    dev_accuracy_by_layer = task_vector_accuracy_by_layer(
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 183, in task_vector_accuracy_by_layer
    answers = modulated_generate(
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 222, in modulated_generate
    _move_inputs_to_device(inputs, model.device)
  File "/home/yukaalive/2025workspace/icl_task_vectors/core/task_vectors.py", line 32, in _move_inputs_to_device
    inputs[k] = v.to(device)
RuntimeError: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ20〜23の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: バッチ 7 処理中 (24〜24)
Debug: バッチの隠れ状態の形状: torch.Size([1, 1, 46, 4096])
Debug: HiddenInjector initialized - layers shape: torch.Size([29]), positions shape: torch.Size([4]), hiddens shape: torch.Size([1, 1, 46, 4096])
Debug: Model has 32 layers, dtype torch.float16
Debug: Injection success rate: 32/32 (100.00%)
Debug: generate_kwargs keys: dict_keys(['do_sample', 'temperature', 'top_p', 'max_new_tokens', 'past_key_values'])
Debug: batch_inputs keys: dict_keys(['input_ids', 'attention_mask'])
警告: バッチ24〜24の生成中にエラーが発生しました: CUDA error: device-side assert triggered
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

Debug: 予測完了、25個の回答を生成
Debug: 層29の精度: 0.0000
Debug: 実験進行状況: [==================  ] 93.8% (層 31/32, 現在: 30)
Debug: 層30のテスト中...
Debug: modulated_generate開始 (層=30)
